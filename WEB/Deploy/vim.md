![image.png](https://cuichonghe.oss-cn-shenzhen.aliyuncs.com/markdown/20230118163635.png)


查询软连接命令
```shell
#查找 vi 的运行文件 
which vi 
ls -l /usr/bin/vi 
ls -l /etc/alternatives/vi 
ls -l /usr/bin/vim.basic 

# 查找 vim 的运行文件 
which vim 
ls -l /usr/bin/vim 
ls -l /etc/alternatives/vim 
ls -l /usr/bin/vim.basic

vi 文件名 存在打开 不存在新建 
vi 文件名 + 行数 
不指定行号，会直接定位到文件末尾 如果 vi 异常退出，在磁盘上可能会保存有 交换文件 下次再使用 vi 编辑该文件时，会看到以下屏幕信息，按下字母 d 可以 删除交换文件 即可

```

# 三种工作模式

## 命令模式

打开文件首先进入命令模式，是使用 `vi` 的入口 
通过命令对文件进行常规的编辑操作，例如：定位、翻页、复制、粘贴、删除…… 
在其他图形编辑器下，通过快捷键或者鼠标 实现的操作，都在命令模式下实现

命令模式下进入插入模式（输入模式）输入：【i】或者【o】或者【a】等 
命令模式下进入末行模式（扩展模式）输入：【:】




## 末行模式 
执行 保存、退出 等操作 

要退出 `vi` 返回到控制台，需要在末行模式下输入命令 
末行模式是 `vi` 的出口 
```vim

esc ->
:w  保存不退出 
:q  退出，如果没有保存，不允许退出 
:q! 强行退出，不保存退出 
:wq 保存并退出 
:x  保存并退出
:e! 放弃所有修改，从上次保存文件开始再编辑命令历史



:set nu：设置行号 
:set nonu：设置不显示行号

```

末行命令扩展 
针对文件进行操作的：保存、退出、保存&退出、搜索&替换、另存、新建、浏览文件
```
:e . 会打开内置的文件浏览器，浏览要当前目录下的文件 
:n 文件名 新建文件 
:w 文件名 另存为，但是仍然编辑当前文件，并不会切换文件 
切换文件之前，必须保证当前这个文件已经被保存！

```


## 编辑模式

命令线路图

### 重复次数 
在命令模式下，数字 + 命令,可以让该命令重复执行指定次数 

### 移动和选择

vi 之所以快，关键在于 能够快速定位到要编辑的代码行 移动命令 能够 和 编辑操作 命令 组合使用  

```
移动（基本） 
h ← 
j ↓ 
k ↑ 
l → 

w 向后移动一个单词 
b 向前移动一个单词 

0 行首 
^ 行首，第一个不是空白字符的位置 
$ 行尾 

gg 文件顶部 
G 文件末尾 
数字gg 移动到 数字 对应行数 
数字G 移动到 数字 对应行数 
:数字 移动到 数字 对应行数 

Ctrl+b 向上翻页 
Ctrl+f 向下翻页 
H 屏幕顶部 
M 屏幕中间 
L 屏幕底部

-------------------------------------
移动（程序） 
`vi` 中使用 空行 来区分段落 
{ 上一段 
} 下一段 
% 括号匹配及切换

```

```

标记 
mx 添加标记 x，x 是 a~z 或者 A~Z 之间的任意一个字母 
'x 直接定位到标记 x 所在位置 
添加了标记的 行如果被删除，标记同时被删除 
如果 在其他行添加了相同名称的标记，之前添加的标记也会被替换掉

```

```
选中文本（可视模式） 
v 可视模式 
V 可视行模式 
Ctrl + v 可视块模式 
可视模式下，可以和 移动命令 连用 
ggVG 能够选中所有内容

```



### 编辑操作 
#### 撤销
```
u 撤销上次命令 
CTRL + r 恢复撤销的命令
```

#### 删除

```
删除文本 
x 删除光标所在字符，或者选中文字 
d(移动命令) 删除移动命令对应的内容 
dd 删除光标所在行，可以 ndd 复制多行 
D 删除至行尾

删除命令可以和 移动命令 连用，以下是常见的组合命令 
dw # 从光标位置删除到单词末尾 
d0 # 从光标位置删除到一行的起始位置
d} # 从光标位置删除到段落结尾 
ndd # 从光标位置向下连续删除 n 行 
d代码行G # 从光标所在行 删除到 指定代码行 之间的所有代码 
d'a # 从光标所在行 删除到 标记a 之间的所有代码
```
#### 复制、粘贴
```
`vi` 中提供有一个 被复制文本的缓冲区 
复制 命令会将选中的文字保存在缓冲区 
删除 命令删除的文字会被保存在缓冲区 
在需要的位置，使用 粘贴 命令可以将缓冲区的文字插入到光标所在位置

y(移动命令) 复制 
yy 复制一行，可以 nyy 复制多行 
p 粘贴

vi 中的 文本缓冲区同样只有一个，如果后续做过 复制、剪切 操作， 之前缓冲区中的内容会被替换 
vi 中的 文本缓冲区 和系统的 剪贴板 不是同一个 所以在其他软件中使用 `CTRL + C` 复制的内容，不能在 `vi` 中通过 `P` 命令粘贴 
可以在 编辑模式 下使用 鼠标右键粘贴
```


#### 插入

```
进入编辑模式 
i 在当前字符前插入文本 
I 在行首插入文本 
a 在当前字符后添加文本 
A 在行末添加文本 
o 在当前行后面插入一空行 
O 在当前行前面插入一空行

```


#### 缩进

```
缩排和重复执行 
>> 向右增加缩进 
<< 向左减少缩进 
. 重复上次命令 
在可视模式下，缩排命令只需要使用一个 `>` 或者 `<`

```





### 查找替换
```
常规查找 
/str 查找 str  
n: 查找下一个 
N: 查找上一个 
如果不想看到高亮显示，可以随便查找一个文件中不存在的内容即可 

* 向后查找当前光标所在单词 
# 向前查找当前光标所在单词

```

```
在 vi 中查找和替换命令需要在 末行模式 下执行 
:%s///g 全局替换 
:%s/旧文本/新文本/g 

可视区域替换 先选中 要替换文字的 范围 
:s/旧文本/新文本/g 

确认替换 
:%s/旧文本/新文本/gc 
y - yes 替换 
n - no 不替换 
a - all 替换所有 
q - quit 退出替换 
l - last 最后一个，并把光标移动到行首 
^E 向下滚屏 
^Y 向上滚屏
```

```
R 命令可以进入 替换模式，替换完成后，按下 ESC 可以回到 命令模式 
替换命令 的作用就是不用进入 编辑模式，对文件进行 轻量级的修改 

r 替换当前字符 命令模式 
R 替换当前行光标后的字符 替换模式

```

### 分屏

```
【vim FILE1 FILE2 FILE3】可以同时编辑FILE1 FILE2 FILE3这三个文件 
【:next】切换至下一个文件 
【:prev】切换至前一个文件 
【:last】切换至最后一个文件 
【:first】切换至第一个文件
```

```
分屏命令 同时编辑和查看多个文件 
:sp [文件名] 横向增加分屏 
:vsp [文件名] 纵向增加分屏


切换分屏窗口 
分屏窗口都是基于 `CTRL + W` 这个快捷键 
w 切换到下一个窗口 
r 互换窗口 
c 关闭当前窗口，但是不能关闭最后一个窗口 
q 退出当前窗口，如果是最后一个窗口，则关闭 vi 
o 关闭其他窗口

调整窗口大小 
基于 CTRL + W 
+ 增加窗口高度 
- 减少窗口高度 
> 增加窗口宽度 
< 减少窗口宽度 
= 等分窗口大小 
调整窗口宽高的命令可以和数字连用，例如：`5 CTRL + W +` 连续 5 次增加高度


fg 程序编号:切换后台挂起程序 
jobs:查看后台挂起的程序 
ctrl+z：将程序挂起
```



# vimrc

vim配置文件

Linux 中 vimrc 有两个位置，**家目录下的配置文件优先级更高**

```
/etc/vim/vimrc 
~/.vimrc
```
常用的插件有：

* 代码补全
* 代码折叠
* 搜索
* Git 集成

可网上找可用的配置



# 练习

```
连续输入 10 个星号

1. 10
2. i 进入编辑模式
3. * 输入文本
4. ESC 返回命令模式 返回后输入10个星号
```

```
利用 可视块 给多行代码增加注释

1. 移动到要添加注释的 第 1 行代码，按 `^` 来到行首
2. 按 `CTRL + v` 进入 可视块 模式
3. 使用 `j` 向下连续选中要添加的代码行
4. 输入 `I` 进入 编辑模式，并在 行首插入，注意：一定要使用 I
5. 输入 `# ` 也就是注释符号
6. 按下 `ESC` 返回到 命令模式，返回之后 `vi` 会在之前选中的每一行代码 前 插入 `# `



```